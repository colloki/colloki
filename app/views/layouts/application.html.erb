<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Article" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <%= csrf_meta_tag %>
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />

  <% if request.filtered_parameters["controller"] === "stories" and
        request.filtered_parameters["action"]     === "show" %>
    <%= render :partial => "partials/story_open_graph_meta", :locals => {
      :story => @story
    } %>
  <% end %>

  <link href="<%= feed_url %>" rel="alternate" title="RSS" type="application/rss+xml">

  <title>
    <% if @page_title.blank? %>
      Virtual Town Square
    <% else %>
      <%= @page_title %> - VTS
    <% end %>
  </title>
  
  <%= stylesheet_link_tag "bootstrap/css/bootstrap.css" %>
  <%= stylesheet_link_tag "site.less", :rel => "stylesheet/less" %>

  <%= include_javascripts :common %>

  <%= render :partial => 'partials/uservoice' %>
  <%= render :partial => 'partials/google_analytics' %>

  <script type="text/javascript">
    var APP_ROOT_PATH = "<%= root_url %>";
  </script>
</head>
<body>
  <div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
      <div class="container">
        <a class="brand" href="<%=root_url%>" title="Virtual Town Square" tabIndex="1">
          Virtual Town Square
        </a>

        <!-- Search -->
        <form class="navbar-search pull-right" id="search" action="/search">
          <input type="text" class="search-query" name="query" placeholder="Search" tabIndex="1" />
        </form>

        <!-- Share Button -->
        <div class="pull-right" id="navbar-share">
          <a data-toggle="modal" href="#navbar-share-modal" class="btn btn-success">
            <i class="icon-edit icon-white"></i>
            Share
          </a>
          &nbsp;&nbsp;
        </div>

        <div class="nav-collapse">
          <ul class="nav">
            <% if logged_in? %>
              <% if request.filtered_parameters["controller"] === "users" and
                request.filtered_parameters["action"] === "show" %>
                <li class="active">
              <% else %>
                <li>
              <% end %>
                <%= link_to "Profile", current_user %>
              </li>
              <% if request.filtered_parameters["controller"] === "users" and
                request.filtered_parameters["action"] === "settings" %>
                <li class="dropdown active">
              <% else %>
                <li class="dropdown">
              <% end %>
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                  <%= current_user.login %>
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li><%= link_to "Settings", settings_url %></li>
                  <li><%= link_to "Sign out", logout_url %></li>
                </ul>
              </li>
            <% else %>
              <li><%= link_to "About", about_url %></li>
              <li><%= link_to "Sign In", login_url %></li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="container">
    
    <!-- Navigation -->
    <% places_without_topics_list = 
      ["/login",
       "/signup",
       "/complete_signup",
       "/forgot_password",
       "/users",
       "/users/new"] %>
    
    <% if (!places_without_topics_list.include? request.fullpath and 
      !request.fullpath.include? 'auth' and @today_topics) %>
       
       <div class="row">
        <div class="span4">
          <ul class="nav nav-pills">
            
            <!-- Latest -->
            <% if request.filtered_parameters["controller"] === "topics" and
              request.filtered_parameters["action"] === "latest" %>
              <li class="active">
              <% icon = "icon-time icon-white" %>
            <% else %>
              <li>
              <% icon = "icon-time" %>
            <% end %>
              <%= link_to ("<i class='" + icon + "'></i> Latest").html_safe, latest_url %>
            </li>

            <!-- Most Popular -->
            <% if request.filtered_parameters["controller"] === "topics" and
              request.filtered_parameters["action"] === "popular" %>
              <li class="active">
              <% icon = "icon-fire icon-white" %>
            <% else %>
              <li>
              <% icon = "icon-fire" %>
            <% end %>
              <%= link_to ("<i class='" + icon + "'></i> Most Discussed").html_safe, popular_url %>
            </li>
          </ul>
        </div>

        <div class="pull-right">
          <div class="row">
            <!-- Time Period Selection for Topics -->
            <div class="span1" style="width: 100px; margin-right: 0">
              <ul class="nav nav-pills">
                <li class="dropdown">
                  <a class="dropdown-toggle active"
                     data-toggle="dropdown"
                     href="#">
                     <i class="icon-list"></i>
                     <span class="topic_when">Today</span>
                     <b class="caret"></b>
                  </a>
                  <ul class="dropdown-menu">
                    <li><a href="#">This Week</a></li>
                    <li><a href="#">This Month</a></li>
                  </ul>
                </li>
              </ul>
            </div>

            <!-- Topics for the chosen time period -->
            <div class="span6" style="width: 400px; margin-left: 0">
              <%= render :partial => "partials/topics_navigation",
                    :locals => {
                      :topics         => @today_topics,
                      :story          => @story,
                      :selected_topic => (defined? @topic) ? @topic : nil
                    }
                %>
            </div>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Message Notifications -->
    <% if flash[:notice] %>
      <div class="alert alert-success" data-dismiss="alert">
        <a class="close" href="#">&times;</a>
        <%= flash[:notice] %>
      </div>
    <% end %>
    <% if flash[:alert] %>
      <div class="alert alert-info" data-dismiss="alert">
        <a class="close" href="#">&times;</a>
        <%= flash[:alert] %>
      </div>
    <% end %>
    <% if flash[:error] %>
      <div class="alert alert-error" data-dismiss="alert">
        <a class="close" href="#">&times;</a>
        <%= flash[:error] %>
      </div>
    <% end %>
    <%= yield %>
    <hr>

    <%= render :partial => 'partials/footer' %>

    <!-- Modal for share button -->
    <%= render :partial => "partials/share_modal" %>
    
  </div>
</body>
</html>