<% if @user %>
  <!-- User Profile Header -->
  <div class="user-header well row" style='margin-left:0px'>
    <% if @user.email and @user.email != '' %>
      <div class="span1 pull-left" style='margin-top: 7px'>
        <%= gravatar_image_tag(@user.email, :gravatar => { :size => 50 }) %>
      </div>
    <% end %>
    <div class="span10">
      <h3>
        <% if @user.realname and @user.realname != '' %>
          <%= @user.realname %>
        <% else %>
          <%= @user.login %>
        <% end %>
      </h3>
      <div class="user-info">
        <% if @user.bio and @user.bio != '' %>
          <%= @user.bio %> •
        <% end %>
        <% if @user.website and @user.website != '' %>
          <%= link_to @user.website, @user.website %> •
        <% end %>
        <% if @user.location and @user.location != '' %>
          <i class='icon-map-marker'></i>
          <%= @user.location %>
        <% end %>

        <% if @user.bio or @user.website or @user.location %>
          <br>
        <% end %>

        <%= @user.stories.count %> Posts •
        <%= @user.comments.count %> Comments •
        <%= @liked_stories.count %> Likes
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <ul class="nav nav-tabs">
    <li class="active">
      <a href="#posts" data-toggle="tab">
        <i class="icon-pencil"></i> Posts
      </a>
    </li>
    <li>
      <a href="#comments" data-toggle="tab">
        <i class="icon-comment"></i> Comments
      </a>
    </li>
    <li>
      <a href="#likes" data-toggle="tab">
        <i class="icon-star"></i> Liked Stories
      </a>
    </li>
  </ul>
  <div class="tab-content">

    <!-- User's posts -->
    <div class="tab-pane active" id="posts">
      <%= render :partial => "partials/story_items", :locals => { :stories => @stories } %>
      <% if @stories.count == 0 %>
        <h5>No posts yet</h5>
      <% end %>
      <% if @tags.count != 0 %>
        <h4>
          <%= @user.login %>'s tag cloud
        </h4>
        <%= render :partial => "partials/tag_cloud", :locals => { :tags => @tags, :topic => false } %>
      <% end %>
    </div>

    <!-- Liked stories -->
    <div class="tab-pane" id="likes">
      <% if @liked_stories.count != 0 %>
        <%= render :partial => "partials/story_items",
          :locals => { :stories => @liked_stories } %>
      <% else %>
        <h5>No stories liked yet</h5>
      <% end %>
    </div>

    <!-- Comments -->
    <div class="tab-pane" id="comments">
      <% if @comments.count != 0 %>
        <% for comment in @comments %>
          <blockquote>
            <p>
              <%= comment.body %>
            </p>
            <small>
              <%= time_ago_in_words(comment.created_at) %> ago in response to
              <%= link_to comment.story.title, :controller => "stories", :action => "show", :id => comment.story.id %>
            </small>
          </blockquote>
        <% end %>
      <% else %>
        <h5>No comments yet</h5>
      <% end %>
    </div>

  </div>
<% else %>
  <h2>Oops! User Not Found</h2>
<% end %>

<% for story in @stories %>
  <%= render :partial => "partials/button/comment/modal", :locals => {:story => story} %>
<% end %>
